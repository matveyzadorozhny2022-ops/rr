<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tap Game</title>

<style>
*{box-sizing:border-box;touch-action:manipulation;}
body{
margin:0;padding:0;display:flex;flex-direction:column;justify-content:center;align-items:center;
font-family:"Comic Sans MS";color:#fff;height:100dvh;overflow:hidden;
background:#000 url('fon.jpg') center/cover no-repeat;
}

/* ---- fixed message ---- */
#message{
height:60px;display:flex;align-items:center;justify-content:center;font-size:1.2rem;text-align:center;
transition:opacity .3s ease;
}

/* ---- slot ---- */
#slot{
width:100%;display:flex;justify-content:center;align-items:center;height:220px;position:relative;
}

#btn,#gift{
width:45vw;max-width:220px;position:absolute;transition:.4s ease;
user-select:none;pointer-events:auto;
}

#btn{cursor:pointer;}
#btn:active{transform:scale(.9);}

#gift{
opacity:0;transform:scale(.7);pointer-events:none;
}

@media(max-width:480px){#btn,#gift{width:60vw;}}

/* ---- progress ---- */
.progress-wrap{
width:55vw;max-width:350px;height:8px;background:rgba(255,255,255,.15);
border-radius:20px;overflow:hidden;margin-top:8px;transition:.35s;
}
.progress{height:100%;width:0;background:#FFB400;transition:width .22s linear;}

/* ---- menu ---- */
#confirmBox{
position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(.85);
background:rgba(0,0,0,.92);padding:22px;border-radius:16px;
text-align:center;color:#fff;opacity:0;pointer-events:none;
backdrop-filter:blur(6px);transition:.28s;
}
#confirmBox.show{opacity:1;pointer-events:auto;transform:translate(-50%,-50%) scale(1);}
.confirm-btn{
padding:10px 25px;border:none;border-radius:12px;font-size:1rem;
margin:6px;font-weight:bold;cursor:pointer;transition:.2s;
}
.confirm-btn:active{transform:scale(.92);}
#sellBtn{background:#0092ff;color:#fff;}
#receiveBtn{background:#FFD800;color:#222;}

/* ---- fireworks ---- */
.firework{
position:absolute;pointer-events:none;
will-change:transform,opacity;
}
</style>
</head>

<body>

<div id="message">üëÜ –ù–∞–∂–∏–º–∞–π, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫!</div>

<div id="slot">
<img id="btn">
<img id="gift">
</div>

<div class="progress-wrap"><div id="bar" class="progress"></div></div>

<div id="confirmBox">
<p>–ü—Ä–æ–¥–∞—Ç—å –∏–ª–∏ –ø–æ–ª—É—á–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫?</p>
<button id="sellBtn" class="confirm-btn">–ü–†–û–î–ê–¢–¨</button>
<button id="receiveBtn" class="confirm-btn">–ü–û–õ–£–ß–ò–¢–¨</button>
</div>

<script>
/* --- DOM --- */
const msg=document.getElementById("message");
const btn=document.getElementById("btn");
const gift=document.getElementById("gift");
const bar=document.getElementById("bar");
const box=document.getElementById("confirmBox");
const sell=document.getElementById("sellBtn");
const recv=document.getElementById("receiveBtn");
const barWrap=document.querySelector(".progress-wrap");

/* --- Resources --- */
const btns=['btn1.webp','btn2.webp','btn3.webp'];
const gifts = Array.from({length:15},(_,i)=>`g${i+1}.webp`);
const fw=['f1.webp','f2.webp','f3.webp'];
btn.src = btns[Math.random()*3|0];

/* --- Perf detect --- */
const cores = navigator.hardwareConcurrency || 2;
const isMobile = matchMedia("(pointer: coarse)").matches;
const LOW = cores<=3;

/* --- fireworks count --- */
const FW_COUNT = LOW ? 10 : (isMobile ? 20 : 60);

/* --- Game logic --- */
let taps=0,total=5,started=false;

btn.addEventListener("click",tap);

function tap(){
taps++;
if(!started){
started=true;
btn.style.animation="pulse .6s infinite alternate";
document.head.insertAdjacentHTML("beforeend",
"<style>@keyframes pulse{to{transform:scale(.92);}}</style>");
}

bar.style.width=(taps/total*100)+"%";

msg.textContent = taps<total
? `–ü—Ä–æ–¥–æ–ª–∂–∞–π! –û—Å—Ç–∞–ª–æ—Å—å ${total-taps} —Ç–∞–ø–æ–≤ üéÅ`
: `üéâ –ü–æ–¥–∞—Ä–æ–∫ –ø–æ–ª—É—á–µ–Ω!`;

if(taps===total) revealGift();
}

function revealGift(){
btn.style.opacity=0;
barWrap.style.opacity=0;

setTimeout(()=>{btn.style.pointerEvents="none";barWrap.style.display="none";},350);

gift.src = gifts[Math.random()*15|0];
gift.style.opacity=1;
gift.style.transform="scale(1)";
gift.style.pointerEvents="auto";

launchFX();
}

/* ---- FX ---- */
function launchFX(){
let n = FW_COUNT;
let i=0;

(function loop(){
if(i>=n) return;
spawn();
i++;
requestAnimationFrame(loop);
})();

function spawn(){
const f=document.createElement("im");
f.src = fw[Math.random()*fw.length|0];
f.className="firework";
f.style.width = (isMobile?70:120) + "px";
f.style.left = isMobile ? "50%" : Math.random()*100+"vw";
if(isMobile) f.style.transform="translateX(-50%)";
f.style.top = (Math.random()*-30)+"vh";
f.style.animation=`fall ${0.8+Math.random()*1}s linear forwards`;
document.body.appendChild(f);
setTimeout(()=>f.remove(),1600);
}
}

/* ---- Menu ---- */
gift.onclick=()=>box.classList.add("show");

sell.onclick=()=>finish("üí∞ –ü—Ä–æ–¥–∞–Ω–æ! ‚≠ê –°–∫–æ—Ä–æ –ø–æ—Å—Ç—É–ø—è—Ç –Ω–∞ –≤–∞—à –±–∞–ª–∞–Ω—Å Telegram");
recv.onclick=()=>finish("üéÅ –ü–æ–¥–∞—Ä–æ–∫ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –≤–∞—à –ø—Ä–æ—Ñ–∏–ª—å –≤ —Ç–µ—á–µ–Ω–∏–∏ –º–∏–Ω—É—Ç—ã");

function finish(text){
box.classList.remove("show");
msg.textContent=text;
gift.style.opacity=0;
gift.style.transform="scale(.7)";
setTimeout(()=>gift.style.pointerEvents="none",300);
}
</script>
</body>
</html>
