<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tap Game Optimized</title>
<style>
*{box-sizing:border-box;touch-action:manipulation;}
body{
margin:0;padding:0;display:flex;flex-direction:column;justify-content:center;align-items:center;
font-family:"Comic Sans MS";color:#fff;height:100dvh;overflow:hidden;
background:#000 url('fon.jpg') center/cover no-repeat;
-webkit-tap-highlight-color: transparent; /* —É–±–∏—Ä–∞–µ—Ç —Å–∏–Ω–µ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
}
#topWrap{display:flex;flex-direction:column;align-items:center;gap:4px;margin-bottom:6px;}
#message{min-height:52px;display:flex;align-items:center;justify-content:center;
font-size:1.25rem;text-align:center;transition:.25s;}
#slot{width:100%;display:flex;justify-content:center;align-items:center;height:280px;position:relative;}
#btn,#gift{width:75vw;max-width:360px;position:absolute;user-select:none;will-change:transform,opacity;}
#gift{opacity:0;transform:scale(.75);pointer-events:none;transition:.28s ease;}
#btn{cursor:pointer;transition:transform .18s ease;outline:none;border:none;-webkit-tap-highlight-color:transparent;}
#btn:active{transform:scale(.9);}
@media(max-width:480px){#btn,#gift{width:80vw;}}
.progress-wrap{width:65vw;max-width:400px;height:8px;background:rgba(255,255,255,.25);
border-radius:20px;overflow:hidden;transition:.25s;}
.progress{height:100%;width:0;background:#FFB400;transition:width .22s linear;}
#confirmBox{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(.85);
background:rgba(0,0,0,.92);padding:22px;border-radius:16px;text-align:center;color:#fff;
opacity:0;pointer-events:none;backdrop-filter:blur(6px);transition:.28s;}
#confirmBox.show{opacity:1;pointer-events:auto;transform:translate(-50%,-50%) scale(1);}
.confirm-btn{padding:10px 25px;border:none;border-radius:12px;font-size:1rem;
margin:6px;font-weight:bold;cursor:pointer;transition:.2s;-webkit-tap-highlight-color:transparent;}
#sellBtn{background:#0092ff;color:#fff;}#receiveBtn{background:#FFD800;color:#222;}
.confirm-btn:active{transform:scale(.92);}
@keyframes pulse{to{transform:scale(.94);}}
</style>
</head>
<body>
<div id="topWrap">
  <div id="message">üëÜ –ù–∞–∂–∏–º–∞–π, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫!</div>
  <div class="progress-wrap"><div id="bar" class="progress"></div></div>
</div>
<div id="slot">
  <img id="btn" loading="eager">
  <img id="gift" loading="lazy">
</div>
<div id="confirmBox">
  <p>–ü—Ä–æ–¥–∞—Ç—å –∏–ª–∏ –ø–æ–ª—É—á–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫?</p>
  <button id="sellBtn" class="confirm-btn">–ü–†–û–î–ê–¢–¨</button>
  <button id="receiveBtn" class="confirm-btn">–ü–û–õ–£–ß–ò–¢–¨</button>
</div>

<script>
const msg=document.getElementById("message"),
      btn=document.getElementById("btn"),
      gift=document.getElementById("gift"),
      bar=document.getElementById("bar"),
      box=document.getElementById("confirmBox"),
      sell=document.getElementById("sellBtn"),
      recv=document.getElementById("receiveBtn"),
      prog=document.querySelector(".progress-wrap");

const btns=['btn1.webp','btn2.webp','btn3.webp'];
const gifts=Array.from({length:15},(_,i)=>`g${i+1}.webp`);
btn.src=btns[Math.random()*3|0];
let taps=0,total=5,started=false;

btn.addEventListener("click",tap);

function tap(){
 if(!started){started=true;btn.style.animation="pulse .65s infinite alternate";}
 taps++;
 bar.style.width=(taps/total*100)+"%";
 msg.textContent=taps<total?`–ü—Ä–æ–¥–æ–ª–∂–∞–π! –û—Å—Ç–∞–ª–æ—Å—å ${total-taps} —Ç–∞–ø–æ–≤ üéÅ`:`üéâ –ü–æ–¥–∞—Ä–æ–∫ –ø–æ–ª—É—á–µ–Ω!`;
 if(taps===total) revealGift();
}

function revealGift(){
 btn.style.opacity=0;
 btn.style.pointerEvents="none";
 setTimeout(()=>btn.style.display="none",200);
 prog.style.opacity=0;
 setTimeout(()=>prog.style.display="none",250);

 const img=new Image();
 img.src=gifts[Math.random()*15|0];
 img.onload=()=>{
   gift.src=img.src;
   gift.style.opacity=1;
   gift.style.transform="scale(1)";
   gift.style.pointerEvents="auto";
 };
}

gift.onclick=()=>box.classList.add("show");

sell.onclick=()=>finish("sell");
recv.onclick=()=>finish("add");

function finish(type){
 box.classList.remove("show");
 gift.style.opacity=0;
 gift.style.transform="scale(.75)";
 setTimeout(()=>gift.style.display="none",150);

 const text = type==="sell"
   ? "üí∞ –ó–≤–µ–∑–¥—ã —Å–∫–æ—Ä–æ –±—É–¥—É—Ç –∑–∞—á–∏—Å–ª–µ–Ω—ã ‚ú®\n‚≠ê –í–æ–∑–≤—Ä–∞—â–∞–π—Å—è –∑–∞–≤—Ç—Ä–∞ –∑–∞ –Ω–∞–≥—Ä–∞–¥–∞–º–∏!"
   : "üéÅ –ü–æ–¥–∞—Ä–æ–∫ —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –ø—Ä–æ—Ñ–∏–ª—å üéâ\n‚ú® –ü—Ä–∏—Ö–æ–¥–∏ –∑–∞–≤—Ç—Ä–∞ –∑–∞ –Ω–æ–≤—ã–º!";
 msg.style.fontSize="1.4rem";
 msg.innerText = text;

 // –ø–æ–∫–∞–∑–∞—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω—É—é –∞–Ω–∏–º–∞—Ü–∏—é L1 –∏–ª–∏ L2
 const anim=document.createElement("img");
 anim.src = type==="sell" ? "L1.webp" : "L2.webp";
 Object.assign(anim.style,{
   position:"absolute",left:"50%",top:"50%",
   transform:"translate(-50%,-50%)",
   width:"55vw",maxWidth:"270px",opacity:0,
   transition:"opacity 0.4s ease",pointerEvents:"none",zIndex:"10"
 });
 document.body.appendChild(anim);
 requestAnimationFrame(()=>anim.style.opacity=1);

 // –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ webp (–±–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è)
 setInterval(()=>{
   anim.src = type==="sell" ? "L1.webp" : "L2.webp";
 },4000);

 // —É–±–∏—Ä–∞–µ–º –∫–Ω–æ–ø–∫—É –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å
 btn.style.display="none";
 prog.style.display="none";
}
</script>
</body>
</html>
